/*!
// ------------------------------------------------------------------------
// (C) CROWNPEAK TECHNOLOGY.
// ------------------------------------------------------------------------
// THIS SOFTWARE IS PROVIDED "AS-IS," WITHOUT ANY EXPRESS OR IMPLIED WARRANTY. 
// IN NO EVENT SHALL CROWNPEAK TECHNOLOGY BE HELD LIABLE FOR ANY DAMAGES ARISING FROM THE USE OF THE SOFTWARE.
// THIS SOFTWARE IS DISTRIBUTED IN THE HOPE THAT IT WILL BE USEFUL, BUT WITHOUT ANY WARRANTY; WITHOUT EVEN THE IMPLIED WARRANTY OF MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE. 
// THERE IS NO WARRANTY FOR THE SOFTWARE, TO THE EXTENT PERMITTED BY APPLICABLE LAW. EXCEPT WHEN OTHERWISE STATED IN WRITING THE COPYRIGHT HOLDERS (INCLUDING BOTH CROWN PEAK TECHNOLOGY 
// AND THE VARIOUS THIRD PARTY COPYRIGHT HOLDERS PROVIDE THE SOFTWARE "AS IS" WITHOUT WARRANTY OF ANY KIND, EITHER EXPRESSED OR IMPLIED, INCLUDING, BUT NOT LIMITED TO, 
// THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE. THE ENTIRE RISK AS TO THE QUALITY AND PERFORMANCE OF THE SOFTWARE IS WITH YOU, THE USER. 
// SHOULD THE SOFTWARE PROVE DEFECTIVE, YOU ASSUME THE COST OF ALL NECESSARY SERVICING, REPAIR OR CORRECTION. IN NO EVENT UNLESS REQUIRED BY APPLICABLE LAW OR AGREED TO IN WRITING 
// WILL ANY COPYRIGHT HOLDER, BE LIABLE TO YOU FOR DAMAGES, INCLUDING ANY GENERAL, SPECIAL, INCIDENTAL OR CONSEQUENTIAL DAMAGES ARISING OUT OF THE USE OR INABILITY TO USE THE SOFTWARE 
// (INCLUDING BUT NOT LIMITED TO LOSS OF DATA OR DATA BEING RENDERED INACCURATE OR LOSSES SUSTAINED BY YOU OR THIRD PARTIES OR A FAILURE OF THE SOFTWARE TO OPERATE WITH ANY OTHER PROGRAMS),
// EVEN IF SUCH HOLDER HAS BEEN ADVISED OF THE POSSIBILITY OF SUCH DAMAGES.
// Version: 0.2.0
*/
var CrownPeakSearch=function(){function g(n,t,i){for(var f,e,u,h,o,r=0,s=n.length;r<s;r++)if(f=n[r],f.id===t){for(e=Object.keys(i),u=0,h=e.length;u<h;u++)o=e[u],f[o]=i[o];break}}function nt(n){for(var t,r,u=n.highlighting,e=Object.keys(u),i=0,a=e.length;i<a;i++){var o=e[i],s=u[o],h=Object.keys(s),c={},l=h.length;if(l>0){for(t=0;t<l;t++)r=h[t],c[r+"_hl"]=f+s[r].join(f)+f;g(n.response.docs,o,c)}}}function tt(n){var r,t,u,i;if(n.response&&n.response.docs&&n.response.docs.length)for(r=n.response.docs,t=0,u=r.length;t<u;t++)i=r[t].type,i&&i.indexOf&&i.indexOf("/")>=0&&(r[t].type_short=i.split("/")[1])}function it(n){var i,u,r,t;if(n.spellcheck&&n.spellcheck.suggestions&&n.spellcheck.suggestions.length&&(t=n.spellcheck.suggestions.length,i=n.spellcheck.suggestions[t-1].suggestion,i.length)){for(u=[],r=0,t=i.length;r<t;r++)u.push(i[r]);n.suggestions=u}}function rt(n){var i,r,t,u;if(h&&n.response&&n.response.docs&&n.response.docs.length)for(i=h,i.indexOf("%%query%%")&&(i=i.replace(/%%query%%/g,encodeURIComponent(y))),r=n.response.docs,t=0,u=r.length;t<u;t++)r[t].proxy_url=i.replace(/%%index%%/g,t)+r[t].url}function ut(t){if(t.pager={page:t.response.start/n+1,pages:[],total:Math.ceil(t.response.numFound/n)},n>0)for(var i=0;i<t.response.numFound/n;i++)t.pager.pages.push(i+1)}function ft(n){var r,i,t,u;if(n.response&&n.response.maxScore&&n.response.docs&&n.response.docs.length)for(r=n.response.maxScore||1,i=n.response.docs,t=0,u=i.length;t<u;t++)i[t].normalizedScore=i[t].score/r}function et(n){var e,r,c,l,o,h,t,u,a,s,i,f,v;if(n.spellcheck&&n.spellcheck.suggestions&&n.spellcheck.suggestions.length){for(e=[],r=0,c=n.spellcheck.suggestions.length;r<c;r+=2)if(l=n.spellcheck.suggestions[r],o=n.spellcheck.suggestions[r+1],l=="collation"){for(h="",t="",u=0,a=o.length;u<a;u+=2)if(s=o[u],i=o[u+1],s=="collationQuery")h=t=i;else if(s=="hits")t+=" ("+i+")";else if(s=="misspellingsAndCorrections")for(f=0,v=i.length;f<v;f+=2){var w=i[f],y=i[f+1],p=new RegExp("\\b"+y+"\\b","i");t=t.replace(p,"<em>"+y+"<\/em>")}e.push({query:h,display:t})}e.length>0&&(n.didYouMean=e)}}function ot(n,t,u){var f=l.replace(/%%PROTOCOL%%/ig,b).replace(/%%COLLECTION%%/ig,r).replace(/%%HANDLER%%/ig,t).replace(/%%QUERY%%/ig,u);return i&&i.replace?i.replace(/%%PROTOCOL%%/ig,b).replace(/%%COLLECTION%%/ig,r).replace(/%%HANDLER%%/ig,t).replace(/%%URL%%/ig,f).replace(/%%URLENCODED%%/ig,encodeURIComponent(f)):f}function w(n,t){var i=new k,u;return t=t||v||"select",u=ot(r,t,n),console.log("Querying "+u),at(u,p).done(function(n){s&&n.highlighting&&nt(n);t=="suggest"?it(n):(tt(n),rt(n),et(n),ft(n),ut(n));i.resolve(n)}).fail(function(n,t,r){i.reject(n,t,r)}),i.promise()}function st(i,r,f){y=i;var h="q="+encodeURIComponent(i)+(i?"":"&q.alt=*")+"&echoParams=explicit&fl=*,score&defType=edismax&wt=json&start="+r*n+"&rows="+Math.min(n,d)+(c!==""?"&fq=language:"+c:"")+(a?"&spellcheck=true&spellcheck.collate=true&spellcheck.collateExtendedResults=true":"")+(f&&f.length>0?"&fq="+f.join("&fq="):"")+(u.length>0?"&facet=true&facet.mincount=1&facet.field="+u.join("&facet.field="):"")+(u.length>0&&e>0?"&facet.limit="+e:"")+(o.length>0?"&sort="+o.join(","):"")+(s?"&hl=true&hl.fl=*&hl.snippets=3&hl.simple.pre="+escape("<b>")+"&hl.simple.post="+escape("<\/b>")+"&f.title.hl.fragsize=50000&f.url.hl.fragsize=50000":"")+"&json.wrf=%%CALLBACK%%";return t&&(h=ht(h,t.replace(/^[&]/,""))),w(h)}function ht(n,t){var i=[],e,r,u,s;if(!n)return t;if(!t)return n;for(e=n.split("&"),r=t.split("&"),u=0,s=e.length;u<s;u++){var h=e[u].split("="),f=h[0],c=h[1],o=ct(r,f);if(o>=0){var l=r[o].split("="),a=l[0],v=l[1];",fl,fq,hl.fl,".indexOf(","+f+",")>=0&&i.push(f+"="+c);i.push(a+"="+v);r.splice(o,1)}else i.push(f+"="+c)}return i=i.concat(r),i.join("&")}function ct(n,t){if(!n||!n.length)return-1;for(var i=0,r=n.length;i<r;i++)if(n[i].split("=")[0]===t)return i;return-1}function lt(n){y=n;var i="q="+encodeURIComponent(n)+"&wt=json&spellcheck.collate=false"+(t?"&"+t.replace(/^[&]/,""):"");return w(i,"suggest")}function at(n,t){function s(n,t,i){n.addEventListener?n.addEventListener(t,i):n.attachEvent&&n.attachEvent("on"+t,function(){i.call(n)})}function e(){f&&(clearTimeout(f),f=null)}function h(){window[u]=c;i&&(i.parentElement.removeChild(i),i=null)}var r=new k,i,o;try{var u="searchg2_"+Math.random().toString().substr(2),c=window[u],f=null;t&&!isNaN(t)&&(f=setTimeout(function(){try{e()}catch(t){}finally{r.reject("timeout",n)}},t));window[u]=function(t){e();r.resolve(t,n)};i=document.createElement("script");o=function(t){e();h();t.type==="error"&&r.reject("error",n)};s(i,"load",o);s(i,"error",o);i.src=n.replace(/%%CALLBACK%%|%25%25CALLBACK%25%25/ig,u);document.getElementsByTagName("head")[0].appendChild(i)}catch(l){r.reject(n,"error",l)}return r.promise()}function k(){var n={args:null,state:"pending",doneList:[],failList:[],alwaysList:[]},t=function(n,t){for(var i=0,r=n.length;i<r;i++)n[i].apply(n[i],t)};return{promise:function(){return{status:function(){return n.state},done:function(t){return n.state=="resolved"?t.apply(t,n.args):n.doneList.push(t),this},fail:function(t){return n.state=="rejected"?t.apply(t,n.args):n.failList.push(t),this},always:function(t){return n.state=="rejected"||n.state=="resolved"?t.apply(t,n.args):n.alwaysList.push(t),this}}},resolve:function(){n.state==="pending"&&(n.state="resolved",n.args=arguments,t(n.doneList,arguments),t(n.alwaysList,arguments))},reject:function(){n.state==="pending"&&(n.state="rejected",n.args=arguments,t(n.failList,arguments),t(n.alwaysList,arguments))}}}var vt=this,b=location.protocol=="file:"?"http:":location.protocol,i="",l="%%PROTOCOL%%//searchg2.crownpeak.net/%%COLLECTION%%/%%HANDLER%%?%%QUERY%%",d=200,n=10,r="www.crownpeak.com",t="",u=[],e=5,o=[],a=!1,s=!1,f="...",h="",c="",v="select",y="",p=5e3;return typeof console=="undefined"?console={log:function(){}}:console.log||(console.log=function(){}),{rows:function(t){return t!==undefined&&(n=t),n},searchProxy:function(n){return n!==undefined&&(i=n),i},endpoint:function(n){return n!==undefined&&(l=n),l},collection:function(n){return n!==undefined&&(r=n),r},facets:function(n){return n!==undefined&&(u=typeof n=="string"?[n]:n),u},maxFacets:function(n){return n!==undefined&&(e=n),e},handler:function(n){return n!==undefined&&(v=n),v},highlight:function(n){return n!==undefined&&(s=n),s},highlightSeparator:function(n){return n!==undefined&&(f=n),f},language:function(n){return n!==undefined&&(c=n),c},spellcheck:function(n){return n!==undefined&&(a=n),a},sort:function(n){return n!==undefined&&(o=typeof n=="string"?[n]:n),o},timeout:function(n){return n!==undefined&&(p=n),p},parameters:function(n){return n!==undefined&&(t=n),t},resultProxy:function(n){return n!==undefined&&(h=n),h},query:function(n,t,i){return t||(t=1),st(n,t-1,i)},autocomplete:function(n){return lt(n)},raw:function(n){return w(n)}}}();Object.keys||(Object.keys=function(){"use strict";var t=Object.prototype.hasOwnProperty,i=!{toString:null}.propertyIsEnumerable("toString"),n=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],r=n.length;return function(u){if(typeof u!="object"&&(typeof u!="function"||u===null))throw new TypeError("Object.keys called on non-object");var e=[],o,f;for(o in u)t.call(u,o)&&e.push(o);if(i)for(f=0;f<r;f++)t.call(u,n[f])&&e.push(n[f]);return e}}());
//# sourceMappingURL=crownpeak.searchg2-0.2.0.min.js.map
